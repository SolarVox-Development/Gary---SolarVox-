name: Discord Embed Notification

on:
  push:
    branches:
      - main  # You can change this to any branch (or remove it for all branches)

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # Grab the latest commit message for the embed
      - name: Set commit message
        run: echo "GITHUB_COMMIT_MESSAGE=$(git log -1 --pretty=%B)" >> $GITHUB_ENV

      # Build the Discord embed JSON
      - name: Prepare Discord Embed
        run: |
          mkdir -p temp
          echo '{
            "embeds": [
              {
                "title": "ðŸš€ Push to '"$GITHUB_REPOSITORY"'",
                "color": 3066993,
                "fields": [
                  {"name": "Branch", "value": "'"$GITHUB_REF_NAME"'", "inline": true},
                  {"name": "Pusher", "value": "'"$GITHUB_ACTOR"'", "inline": true},
                  {"name": "Commit", "value": "[ '"$GITHUB_SHA"' ](https://github.com/'"$GITHUB_REPOSITORY"'/commit/'"$GITHUB_SHA"')", "inline": false},
                  {"name": "Message", "value": "'"${GITHUB_COMMIT_MESSAGE}"'", "inline": false}
                ],
                "timestamp": "'"$(date --utc +%Y-%m-%dT%H:%M:%SZ)"'"
              }
            ]
          }' > temp/embed.json

      # Send the embed to Discord
      - name: Send Discord Embed
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        with:
          args: --file temp/embed.json
